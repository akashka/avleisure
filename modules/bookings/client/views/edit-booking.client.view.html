<section>
  <div class="page-header">
    <div class="row">
        <div class="col-md-6"> <h1>Edit Booking</h1> </div>
        <div class="col-md-4" style="float: right; margin-top: 2em">
          <a class="btn btn-primary" ui-sref="bookings.list">
            <i class="glyphicon glyphicon-check"> LIST BOOKINGS</i>
          </a>
        </div>
    </div>
  </div>

  <div class="col-md-12">
    <form name="vm.form.bookingForm" ng-submit="vm.save(vm.form.bookingForm.$valid)" novalidate>
      <fieldset>
        <div class="form-group col-md-6" style="margin-bottom: 5px ! important;">
          <label class="control-label" for="booking_date">Execution Date: </label>
          <p class="input-group">
            <input type="text" class=" input-group form-control" uib-datepicker-popup="dd-MMM-yyyy" ng-model="vm.booking.booking_date" is-open="vm.dateset.lr_date.isOpened" datepicker-options="vm.dateOptions" ng-required="true" />
            <span class="input-group-btn">
            <button type="button" class="btn btn-default" ng-click="vm.selectDate($event, 1)"><i class="glyphicon glyphicon-calendar"></i></button>
            </span>
          </p>
        </div>
        <div class="form-group col-md-6" show-errors>
          <label class="control-label" for="school_name">School Name: </label>
          <input name="school_name" type="text" ng-model="vm.booking.school_name" id="school_name" class="form-control" placeholder="School Name" required autofocus>
          <div ng-messages="vm.form.bookingForm.school_name.$error" role="alert">
            <p class="help-block error-text" ng-message="required">Booking school name is required.</p>
          </div>
        </div>
        <div class="form-group col-md-6" show-errors>
          <label class="control-label" for="contact_person">Contact Person: </label>
          <input name="contact_person" type="text" ng-model="vm.booking.contact_person" id="contact_person" class="form-control" placeholder="Contact Person" required autofocus>
          <div ng-messages="vm.form.bookingForm.contact_person.$error" role="alert">
            <p class="help-block error-text" ng-message="required">Booking contact person is required.</p>
          </div>
        </div>
        <div class="form-group col-md-6" show-errors>
          <label class="control-label" for="contact_email">Contact Email: </label>
          <input name="contact_email" type="text" ng-model="vm.booking.contact_email" id="contact_email" class="form-control" placeholder="Contact Email" required autofocus>
          <div ng-messages="vm.form.bookingForm.contact_email.$error" role="alert">
            <p class="help-block error-text" ng-message="required">Booking contact email is required.</p>
          </div>
        </div>
        <div class="form-group col-md-6" show-errors>
          <label class="control-label" for="contact_phone">Contact Phone: </label>
          <input name="contact_phone" type="text" ng-model="vm.booking.contact_phone" id="contact_phone" class="form-control" placeholder="Contact Phone" required autofocus>
          <div ng-messages="vm.form.bookingForm.contact_phone.$error" role="alert">
            <p class="help-block error-text" ng-message="required">Booking contact phone is required.</p>
          </div>
        </div>
        <div class="form-group col-md-6" show-errors>
          <label class="control-label" for="no_of_students">No. of Students: </label>
          <input name="no_of_students" type="text" ng-model="vm.booking.no_of_students" id="no_of_students" class="form-control" placeholder="No. of Students" required autofocus>
          <div ng-messages="vm.form.bookingForm.no_of_students.$error" role="alert">
            <p class="help-block error-text" ng-message="required">No. of Students is required.</p>
          </div>
        </div>
        <div class="form-group col-md-6" show-errors>
          <label class="control-label" for="no_of_staff">No. of Staff: </label>
          <input name="no_of_staff" type="text" ng-model="vm.booking.no_of_staff" id="no_of_staff" class="form-control" placeholder="No. of Staff" required autofocus>
          <div ng-messages="vm.form.bookingForm.no_of_students.$error" role="alert">
            <p class="help-block error-text" ng-message="required">No. of Staff is required.</p>
          </div>
        </div>
        <div class="form-group col-md-6" show-errors>
          <label class="control-label" for="class">Class: </label>
          <input name="class" type="text" ng-model="vm.booking.class" id="class" class="form-control" placeholder="class" required autofocus>
          <div ng-messages="vm.form.bookingForm.class.$error" role="alert">
            <p class="help-block error-text" ng-message="required">Booking class is required.</p>
          </div>
        </div>
        <div class="form-group col-md-6">
          <label class="control-label" for="tour_managers">Tour Managers</label>
          <div class="controls">
            <div class="multiselect" ng-dropdown-multiselect="" options="vm.users" selected-model="vm.booking.tour_managers" extra-settings="vm.multiselectSettings"></div>
          </div>
          <div ng-messages="vm.form.bookingForm.tour_managers.$error" role="alert">
            <p class="help-block error-text" ng-message="required">Booking tour managers is required.</p>
          </div>
        </div>
        <div class="form-group col-md-6" show-errors>
          <label class="control-label" for="destination">Destination: </label>
          <select class="form-control" id="itinery" ng-model="vm.booking.destination" ng-options="obj._id as obj.title for obj in vm.itineries">
              <option value=""disabled>Select Destination</option>                
          </select>
          <div ng-messages="vm.form.bookingForm.destination.$error" role="alert">
            <p class="help-block error-text" ng-message="required">Booking destination is required.</p>
          </div>
        </div>

        <div class="form-group col-md-12" style="border-bottom: 1px solid grey;"> 
          <div class="col-md-6"><h4>DETAILS OF FINALIZED AMOUNT WITH SCHOOL </h4></div> 
        </div>

        <div class="form-group col-md-6" show-errors>
          <label class="control-label" for="booking_amount">Booking Amount (Per Person): </label>
          <input name="booking_amount" type="text" ng-model="vm.booking.booking_amount" id="booking_amount" class="form-control" placeholder="Booking Amount" required autofocus ng-change = "vm.calBookingAmount(vm.booking.booking_amount)">
          <div ng-messages="vm.form.bookingForm.booking_amount.$error" role="alert">
            <p class="help-block error-text" ng-message="required">Booking Amount is required.</p>
          </div>
        </div>
        <div class="form-group col-md-6" show-errors>
          <label class="control-label" for="total_booking_amount">Booking Amount (Total): </label>
          <input name="total_booking_amount" type="text" ng-model="vm.booking.total_booking_amount" id="total_booking_amount" class="form-control" placeholder="Total Booking Amount" required autofocus ng-change = "vm.convert(vm.booking.total_booking_amount)">
          <div ng-messages="vm.form.bookingForm.total_booking_amount.$error" role="alert">
            <p class="help-block error-text" ng-message="required">Total Booking Amount is required.</p>
          </div>
        </div>
        <div class="form-group col-md-6" show-errors>
          <label class="control-label" for="bill_amount">Billing Amount: </label>
          <input name="bill_amount" data-ng-model="vm.booking.billing.bill_amount" id="bill_amount" class="form-control" placeholder="Enter Bill Amount" required>
        </div>
        <div class="form-group col-md-6" show-errors>
          <label class="control-label" for="gst_percentage">GST Percentage: </label>
          <input name="amount_paid" data-ng-model="vm.booking.billing.gst_percentage" id="gst_percentage" class="form-control" placeholder="GST Percentage" required>
        </div>

        <div class="form-group col-md-6"> </div>

        <div class="form-group col-md-12" style="border-bottom: 1px solid grey;"> 
          <div class="col-md-6"><h4>PAYMENTS RECEIVED FROM SCHOOL</h4></div> 
          <div class="form-group col-md-6"> 
            <span ng-click="vm.addExtraPay()" style="cursor:pointer;padding:10px;background:green;color:white;min-width:25px;"> + Receive Amt </span>
            <span ng-click="vm.removeExtraPay()" ng-show="vm.booking.amount_paid.length > 0" style="cursor:pointer;margin-left:15px;padding:10px;background:red;color:white;min-width:25px;"> - Remove Amt</span>
          </div>
        </div>
        
        <div class="form-group col-md-6">
          <label class="control-label" for="booking_amount">Total Payment Done from School: {{vm.calculateSchoolPayment('paid')}}</label>
        </div>
        <div class="form-group col-md-6">
          <label class="control-label" for="booking_amount">Balance from School: {{vm.calculateSchoolPayment('balance')}}</label>
        </div>
        <div ng-repeat="amt in vm.booking.amount_paid">
          <div class="row">
              <div class="form-group col-md-6" show-errors>
                <label class="control-label" for="amount_paid">Amount Paid: </label>
                <input name="amount_paid" data-ng-model="amt.amount_paid" id="amount_paid" class="form-control" placeholder="Amount Paid" required>
              </div>
              <div class="form-group col-md-6" show-errors>
                <label class="control-label" for="payment_date">Payment Date: </label>
                <p class="input-group">
                  <input type="text" name="amount_paid" class="input-group form-control" uib-datepicker-popup="dd-MMM-yyyy" ng-model="amt.payment_date" is-open="amt.isOpened" datepicker-options="vm.dateOptions" ng-required="true" />
                  <span class="input-group-btn">
                    <button type="button" class="btn btn-default" ng-click="vm.selectDates($event, amt)"><i class="glyphicon glyphicon-calendar"></i></button>
                  </span>
                </p>
              </div>
              <div class="form-group col-md-6">
                <label class="control-label" for="payment_mode">Payment Mode:</label>
                <div class="controls">
                  <select class="form-control" id="payment_mode" ng-model="amt.payment_mode" ng-list>
                    <option value=""disabled>Select Payment Mode</option>
                    <option value="Cash">Cash</option>
                    <option value="Cheque">Cheque</option>
                    <option value="Online">Online</option>
                  </select>
                </div>
              </div>
              <div class="form-group col-md-6" ng-if="amt.payment_mode == 'Cheque'">
                <label class="control-label" for="cheque_number">Cheque No: </label>
                <input name="cheque_number" data-ng-model="amt.cheque_number" id="cheque_number" class="form-control" placeholder="Cheque Number">
              </div>
              <div class="form-group col-md-6" ng-if="amt.payment_mode == 'Cheque'">
                <label class="control-label" for="bank_name">Bank Name: </label>
                <input name="bank_name" data-ng-model="amt.bank_name" id="bank_name" class="form-control" placeholder="Bank Name">
              </div>
              <div class="form-group col-md-6" ng-if="amt.payment_mode == 'Cheque'">
                <label class="control-label" for="cheque_photo">Cheque Photo: </label>
                <input name="cheque_photo" data-ng-model="amt.cheque_photo" id="cheque_photo" class="form-control" placeholder="Cheque Photo">
              </div>
              <div class="form-group col-md-6" ng-if="amt.payment_mode == 'Online'">
                <label class="control-label" for="transaction_number">Transaction No: </label>
                <input name="transaction_number" data-ng-model="amt.transaction_number" id="transaction_number" class="form-control" placeholder="Transaction Number">
              </div>
          </div>
          <hr>
        </div>

        <div class="col-md-12 text-center" style="margin-bottom:45px;margin-top:15px;">
          <button type="submit" class="btn btn-success">{{vm.booking._id ? 'UPDATE' : 'SAVE'}}</button>
        </div>

      </fieldset>
    </form>
  </div>

</section>
